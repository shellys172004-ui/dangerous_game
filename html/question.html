<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Make Your Choice</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  height:100vh;
  overflow:hidden;
  font-family:'Orbitron',sans-serif;
  background:radial-gradient(circle at top,#0e1a2f,#05070c);
  color:#00fff0;
}
.ui{height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center}
.ui.hidden{display:none}
button{padding:14px 40px;margin:12px;font-family:'Orbitron'}
.transition{position:fixed;inset:0;display:flex;justify-content:center;align-items:center;opacity:0;pointer-events:none}
.transition.active{opacity:1;pointer-events:auto}
.noModal{position:fixed;inset:0;background:#000c;display:flex;justify-content:center;align-items:center;opacity:0;pointer-events:none}
.noModal.active{opacity:1;pointer-events:auto}
</style>
</head>

<body>

<div class="ui" id="mainUI">
  <h2>Will you be my valentine?</h2>
  <button id="yes">YES</button>
  <button id="no">NO</button>
</div>

<div class="transition" id="transition">
  <button id="back">GO BACK</button>
</div>

<div class="noModal" id="noModal">
  <button id="apology">I meant YES</button>
</div>

<audio id="questionSound" src="question.mp3" loop></audio>
<audio id="heartbeat" src="heartbeat.mp3" loop></audio>
<audio id="happySound" src="happy_happy_happy_cat.mp3"></audio>

<script>
const yes = document.getElementById('yes');
const no = document.getElementById('no');
const back = document.getElementById('back');
const apology = document.getElementById('apology');
const mainUI = document.getElementById('mainUI');
const transition = document.getElementById('transition');
const noModal = document.getElementById('noModal');

const questionSound = document.getElementById('questionSound');
const heartbeat = document.getElementById('heartbeat');
const happySound = document.getElementById('happySound');

questionSound.volume = 0.6;
heartbeat.volume = 0.8;
happySound.volume = 1;

let unlocked = false;

/* Stop and reset an audio element */
function stopAudio(a){
  a.pause();
  try { a.currentTime = 0; } catch(e){}
}

/* Ensure ONLY one audio plays */
function playOnly(target){
  [questionSound, heartbeat, happySound].forEach(a => {
    if (a !== target) stopAudio(a);
  });
  try { target.currentTime = 0; } catch(e){}
  target.play().catch(()=>{});
}

/* Which screen are we on? Play the correct sound for that screen */
function syncAudio(){
  if (!unlocked) return;

  const onYesPage = transition.classList.contains('active');   // YES screen
  const onNoModal = noModal.classList.contains('active');      // NO modal open

  if (onYesPage){
    // YES page => happy only
    playOnly(happySound);
  } else if (onNoModal){
    // NO modal => heartbeat only
    playOnly(heartbeat);
  } else {
    // Question page => question sound only
    playOnly(questionSound);
  }
}

/* Unlock audio on the first user gesture (required by browsers) */
function unlockOnce(){
  if (unlocked) return;
  unlocked = true;

  // "Prime" audio elements in the SAME user gesture so later plays work reliably
  [questionSound, heartbeat, happySound].forEach(a => {
    const prevMuted = a.muted;
    a.muted = true;
    const p = a.play();
    if (p && typeof p.then === 'function'){
      p.then(() => {
        a.pause();
        try { a.currentTime = 0; } catch(e){}
        a.muted = prevMuted;
      }).catch(() => {
        a.muted = prevMuted;
      });
    } else {
      a.pause();
      try { a.currentTime = 0; } catch(e){}
      a.muted = prevMuted;
    }
  });
}

/* Helper: ensure unlock + then play correct audio in SAME click */
function unlockAndSync(){
  unlockOnce();
  syncAudio();
}

/* Unlock on first interaction anywhere */
['pointerdown','touchstart','keydown','click'].forEach(evt => {
  document.addEventListener(evt, () => {
    unlockAndSync();
  }, { once:true, passive:true });
});

/* ---- Your original UI logic, just calling syncAudio at the right times ---- */
function showYes(){
  mainUI.classList.add('hidden');
  noModal.classList.remove('active');
  transition.classList.add('active');
  syncAudio();
}

yes.onclick = () => {
  unlockAndSync(); // important if YES is the very first click
  showYes();
};

apology.onclick = () => {
  unlockAndSync();
  showYes();
};

back.onclick = () => {
  transition.classList.remove('active');
  mainUI.classList.remove('hidden');
  noModal.classList.remove('active'); // safety: if it was open
  syncAudio();
};

no.onclick = () => {
  unlockAndSync(); // important if NO is the very first click
  noModal.classList.add('active');
  syncAudio();
};
</script>

</body>
</html>
