<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Make Your Choice</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet" />

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  height:100vh;
  overflow:hidden;
  font-family:'Orbitron',sans-serif;
  background:radial-gradient(circle at top,#0e1a2f,#05070c);
  color:#00fff0;
}
.ui{height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center}
.ui.hidden{display:none}
button{padding:14px 40px;margin:12px;font-family:'Orbitron'}
.transition{position:fixed;inset:0;display:flex;justify-content:center;align-items:center;opacity:0;pointer-events:none}
.transition.active{opacity:1;pointer-events:auto}
.noModal{position:fixed;inset:0;background:#000c;display:flex;justify-content:center;align-items:center;opacity:0;pointer-events:none}
.noModal.active{opacity:1;pointer-events:auto}
</style>
</head>

<body>

<div class="ui" id="mainUI">
  <h2>Will you be my valentine?</h2>
  <button id="yes">YES</button>
  <button id="no">NO</button>
</div>

<div class="transition" id="transition">
  <button id="back">GO BACK</button>
</div>

<div class="noModal" id="noModal">
  <button id="apology">I meant YES</button>
</div>

<audio id="questionSound" src="question.mp3" loop preload="auto"></audio>
<audio id="heartbeat" src="heartbeat.mp3" loop preload="auto"></audio>
<audio id="happySound" src="happy_happy_happy_cat.mp3" preload="auto"></audio>

<script>
const yes = document.getElementById('yes');
const no = document.getElementById('no');
const back = document.getElementById('back');
const apology = document.getElementById('apology');
const mainUI = document.getElementById('mainUI');
const transition = document.getElementById('transition');
const noModal = document.getElementById('noModal');

const questionSound = document.getElementById('questionSound');
const heartbeat = document.getElementById('heartbeat');
const happySound = document.getElementById('happySound');

questionSound.volume = 0.6;
heartbeat.volume = 0.8;
happySound.volume = 1;

let audioUnlocked = false;

// --- helpers ---
function stopAllAudio(){
  [questionSound, heartbeat, happySound].forEach(a => {
    a.pause();
    a.currentTime = 0;
  });
}

function playOnly(audioEl){
  // ensure ONLY this one is audible/playing
  [questionSound, heartbeat, happySound].forEach(a => {
    if (a !== audioEl){
      a.pause();
      a.currentTime = 0;
    }
  });
  // start requested sound (if unlocked; otherwise it will start right after unlock)
  audioEl.currentTime = 0;
  audioEl.play().catch(()=>{});
}

function startQuestionPageAudio(){
  // question page => questionSound only
  playOnly(questionSound);
}

function unlockAudioOnce(){
  if (audioUnlocked) return;
  audioUnlocked = true;

  // Prime all audio elements silently (so first real play works immediately)
  [questionSound, heartbeat, happySound].forEach(a => {
    try{
      a.muted = true;
      const p = a.play();
      if (p && typeof p.then === 'function'){
        p.then(() => {
          a.pause();
          a.currentTime = 0;
          a.muted = false;
        }).catch(()=>{ a.muted = false; });
      }else{
        a.pause();
        a.currentTime = 0;
        a.muted = false;
      }
    }catch(e){}
  });

  // After the first user gesture, we are allowed to start the CURRENT page audio.
  // Right now the current page is the question page.
  startQuestionPageAudio();
}

// Unlock on first user gesture (click/touch/keydown)
['pointerdown','touchstart','keydown','click'].forEach(evt => {
  document.addEventListener(evt, unlockAudioOnce, { once:true, passive:true });
});

// --- UI transitions ---
function showYes(){
  mainUI.classList.add('hidden');
  noModal.classList.remove('active');
  transition.classList.add('active');

  // yes page => happySound only
  playOnly(happySound);
}

yes.onclick = () => {
  if (!audioUnlocked) unlockAudioOnce();
  showYes();
};

apology.onclick = () => {
  if (!audioUnlocked) unlockAudioOnce();
  showYes();
};

back.onclick = () => {
  transition.classList.remove('active');
  mainUI.classList.remove('hidden');

  // back to question page => questionSound only
  if (!audioUnlocked) unlockAudioOnce();
  startQuestionPageAudio();
};

no.onclick = () => {
  if (!audioUnlocked) unlockAudioOnce();
  noModal.classList.add('active');

  // no modal => heartbeat only
  playOnly(heartbeat);
};

// If you ever close the noModal another way in future, call startQuestionPageAudio() there.
</script>

</body>
</html>
